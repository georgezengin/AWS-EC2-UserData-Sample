<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>George's site</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background-color 0.5s, color 0.5s;
    }
    h1 {
      margin-top: 20px;
      font-size: 36px;
    }

    .image-container {
      width: 80%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    .image-container img {
      max-width: 100%;
      max-height: 80vh;
    }

    .joke-container {
      margin-top: 20px;
    }

    .joke-text {
      font-size: 18px;
      margin-bottom: 10px;
      position: relative; /* Ensure relative positioning for tooltip */
      display: inline-block; /* Display as inline block to respect text width */
    }

    .joke-text:hover::before {
      content: attr(title);
      position: absolute;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap; /* Ensure text doesn't wrap */
      z-index: 1;
      bottom: 100%; /* Position above the text */
      left: 50%; /* Center horizontally */
      transform: translateX(-50%); /* Adjust for centering */
    }

    .copy-button {
      background-color: inherit; /* Inherit background color */
      color: inherit;
      border: none;
      padding: 8px 16px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 10px;
      position: relative; /* Ensure icon is positioned correctly */
    }

    .copy-button svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .copy-button:hover {
      background-color: #ddd; /* Adjust hover background color */
    }
  </style>
</head>
<body>
  <h1>Hello World, this is George from $(hostname -f)</h1>
  <div class="image-container">
    <img id="randomImage" src="" alt="Random Image">
  </div>
  <div id="jokeContainer">
    <p id="joke"></p>
  </div>
  <script>
    // List of dark colors
    const darkColors = [
                            // Grayscale
                            '#1a1a1a', '#2e2e2e', '#3c3c3c', '#484848', '#505050', '#5c5c5c',
                            // Blues
                            '#1a1a66', '#2e2e99', '#3c3c99', '#4848b3', '#5050cc', '#5c5cd6',
                            // Reds
                            '#661a1a', '#993333', '#993c3c', '#b34848', '#cc5050', '#d65c5c',
                            // Greens
                            '#1a661a', '#339933', '#3c993c', '#48b348', '#50cc50', '#5cd65c'
                        ];
    // Function to get a random dark color
    function getRandomDarkColor() {
        const randomIndex = Math.floor(Math.random() * darkColors.length);
        return darkColors[randomIndex];
    }

    // Function to get a contrasting color
    function getContrastingColor(hexColor) {
        const r = parseInt(hexColor.substr(1, 2), 16);
        const g = parseInt(hexColor.substr(3, 2), 16);
        const b = parseInt(hexColor.substr(5, 2), 16);
        const yiq = ((r*299)+(g*587)+(b*114))/1000;
        return (yiq >= 128) ? 'black' : 'white';
    }

    function applyRandomBackgroundColor() {
        const bgColor = getRandomDarkColor();
        const textColor = getContrastingColor(bgColor);
        document.body.style.backgroundColor = bgColor;
        document.body.style.color = textColor;
    }

    // Function to fetch a random joke from the JokeAPI
    function fetchJoke() {
        fetch("https://v2.jokeapi.dev/joke/Any")
            .then(response => response.json())
            .then(data => {
                var jokeContainer = document.getElementById("jokeContainer");
                jokeContainer.innerHTML = "";  // Clear previous jokes

                if (data.type === "single" || data.type === "twopart") {
                    // Create joke elements based on type
                    var jokeElements = createJokeElements(data);
                    
                    // Append joke elements to container
                    jokeElements.forEach(element => {
                        jokeContainer.appendChild(element);
                        jokeContainer.appendChild(document.createElement("br")); // New line for spacing
                    });

                    // Add copy button for joke
                    var copyButton = createCopyButton(data);
                    jokeContainer.appendChild(copyButton);
                } else {
                    // No joke found
                    var noJokeElement = document.createElement("p");
                    noJokeElement.textContent = "No joke found!";
                    jokeContainer.appendChild(noJokeElement);
                }
            })
            .catch(error => {
                console.log("Error fetching joke:", error);
            });
    }

    // Function to create joke elements based on type
    function createJokeElements(data) {
      var elements = [];

      var jokeElement = document.createElement("p");
      jokeElement.classList.add("joke-text");
      jokeElement.setAttribute('title', `Category: ${data.category}`); // Tooltip with category

      if (data.type === "single") {
          jokeElement.textContent = data.joke;
          elements.push(jokeElement);
        } 
        else 
        {
          jokeElement.textContent = data.setup;
          elements.push(jokeElement);

          var deliveryElement = document.createElement("p");
          deliveryElement.textContent = data.delivery;
          deliveryElement.classList.add("joke-text");
          elements.push(deliveryElement);
        }

      return elements;
    }

    // Function to create copy button for joke
    function createCopyButton(data) {
      var copyButton = document.createElement("button");
      copyButton.classList.add("copy-button");
      copyButton.setAttribute('aria-label', 'Copy Joke');
      copyButton.setAttribute('title', 'Copy joke'); // Tooltip for copy button
      copyButton.addEventListener('click', function() {
          var textToCopy = data.type === "single" ? data.joke : `${data.setup}\n${data.delivery}`;
          navigator.clipboard.writeText(textToCopy)
              .then(() => {
                playBeep(); // Play beep sound
              })
              .catch(err => {
                  console.error('Unable to copy joke', err);
                  alert('Failed to copy joke to clipboard.');
              });
      });

      // Create copy icon SVG for button
      var copyIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      copyIcon.setAttribute('viewBox', '0 0 24 24');
      copyIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      copyIcon.classList.add('copy-icon');

      var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute('d', 'M18 3h-6a3 3 0 0 0-3 3v1H7v2h2v10h8V9h2V7h-2V4a1 1 0 0 0-1-1zm-4 13H8v-2h6zm3-5H7V6h10z');
      path.setAttribute('fill', 'currentColor');

      copyIcon.appendChild(path);
      copyButton.appendChild(copyIcon);

      return copyButton;
    }
    
    // Function to play a beep sound
    function playBeep() {
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        var oscillator = audioContext.createOscillator();
        oscillator.type = 'sine'; // Type of sound wave
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // Frequency in Hertz (440 Hz is A4 note)
        oscillator.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.1); // Play sound for 0.1 seconds
    }
    
    function generateRandomImageUrl() {
        var viewportWidth = window.innerWidth * 0.8;
        var viewportHeight = window.innerHeight * 0.8;
        var randomWidth = Math.floor(Math.random() * (viewportWidth - viewportWidth * 0.8 + 1)) + viewportWidth * 0.8;
        var randomHeight = Math.floor(Math.random() * (viewportHeight - viewportHeight * 0.8 + 1)) + viewportHeight * 0.8;
        var imageUrl = `https://picsum.photos/${Math.floor(randomWidth)}/${Math.floor(randomHeight)}`;

        return imageUrl;
    }

    // Debounce function to delay execution
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    function updateImage() {
        var imageUrl = generateRandomImageUrl();
        document.getElementById('randomImage').src = imageUrl;
    }

    window.onload = function() {
        applyRandomBackgroundColor();
        updateImage();
        fetchJoke();
    }

    // Debounce the resize event
    window.onresize = debounce(function() {
        applyRandomBackgroundColor();
        updateImage();
        fetchJoke();
    }, 500);  // 500ms delay after resizing

  </script>
</body>
</html>
